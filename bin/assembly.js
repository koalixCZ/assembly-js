"use strict";function endsWith(e,r){return e&&-1!==e.indexOf(r,e.length-r.length)}function isExcluded(e){return e&&"true"===e.toLowerCase()}function isJavaScript(e,r){return"text/javascript"===e&&r||endsWith(r,".js")}function getScriptTagReader(e){return{onopentag:function(r,t){var i=t.src,n=isExcluded(t["data-excluded"]),o=isJavaScript(t.type,t.src);"script"===r&&o&&!n&&e(i)}}}function getHtmlParser(e){return new htmlParser.Parser(getScriptTagReader(e))}function readSourceHtml(e,r){fs.readFile(e,{encoding:"UTF-8",flag:"r"},function(e,t){if(e)throw e;r(t)})}function readFile(e,r,t){fs.readFile(e,{encoding:"UTF-8",flag:"r"},function(e,i){if(e)throw e;t(i,r)})}function transformArrayToString(e){return e.join("\n")}function getSourceMapName(){return config.assembledJS+".map"}function rectifyIncompatibleOptions(e){e.expression&&(e.compress||e.mangle)&&(console.warn("Option 'expression' is not compatible with compress and mangle"),e.compress=!1,e.mangle=!1)}function setupSourceMap(e){e.source_map=UglifyJS.SourceMap({file:getSourceMapName()})}function addSourceMap(e){return config.sourceMap?e+"\n//# sourceMappingURL="+widget.getSourceMapName():e}function uglify(e,r){var t=UglifyJS.Compressor(r.compress),i=UglifyJS.OutputStream(r),n=UglifyJS.parse(e);return n.figure_out_scope(),n.compute_char_frequency(),n.mangle_names(),n=n.transform(t),n.print(i),{code:addSourceMap(i.get()),sourceMap:r.source_map}}function writeFile(e,r,t){fs.writeFile(e,r,"UTF-8",function(e){if(e)throw e;t()})}function pathToTargetDirectory(e,r){return path.join(r,e)}function updateSourcePath(e,r){var t=[];return r.forEach(function(r){t.push(path.join(e,r))}),t}function assembly(e,r){var t=config.assembledJS,i=config.source,n=i.directory,o=config.targetDirectory;reader.readScripts(updateSourcePath(n,e),function(e){var i=uglify.uglify(e),n=pathToTargetDirectory(t,o),a=pathToTargetDirectory(widget.getSourceMapName(),o),u=2,s=function(){u-=1,0===u&&r&&"function"==typeof r&&r()};writeFile(n,i.code,s),writeFile(a,i.sourceMap,s)})}var htmlParser=require("htmlparser2"),fs=require("fs");module.exports.parseHtmlAndReadScripts=function(e,r){readSourceHtml(e,function(e){var t,i=[],n=function(e){i.push(e)};t=getHtmlParser(n),t.write(e),t.end(),r(i)})};var fs=require("fs");module.exports.readScripts=function(e,r){var t=e.length,i=[],n=function(e,n){i[n]=e,t-=1,0===t&&r(transformArrayToString(i))};0===t?r(""):e.forEach(function(e,r){readFile(e,r,n)})};var UglifyJS=require("uglify-js"),config=require("./config.json");module.exports={getSourceMapName:getSourceMapName,rectifyIncompatibleOptions:rectifyIncompatibleOptions,setupSourceMap:setupSourceMap};var UglifyJS=require("uglify-js"),widget=require("./assembly.widget"),config=require("./config.json");module.exports.uglify=function(e){var r=config.options;return widget.rectifyIncompatibleOptions(r),widget.setupSourceMap(r),uglify(e,r)};var fs=require("fs"),path=require("path"),parser=require("./assembly.parser"),reader=require("./assembly.reader"),uglify=require("./assembly.uglify"),widget=require("./assembly.widget"),config=require("./config.json");module.exports.assemblyFromHtml=function(e){parser.parseHtmlAndReadScripts(config.source.html,function(r){assembly(r,e)})},module.exports.assemblyFromArrayOfSources=function(e,r){assembly(e,r)};